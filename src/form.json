{
    "actions": [
        {
            "name": "wordparrot-gmail.read",
            "title": "Gmail - Read Inbox",
            "description": "Fetch a record of the newest emails as they arrive.",
            "type": "pipelineNode",
            "initialValues": {
                "search": "is:unread",
                "limit": 10,
                "mode": "textOnly",
                "action": "none"
            },
            "validationSchema": [
                {
                    "property": "search",
                    "type": "string",
                    "requirement": "optional"
                },
                {
                    "property": "limit",
                    "type": "number",
                    "requirement": "required"
                },
                {
                    "property": "mode",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "action",
                    "type": "string",
                    "requirement": "required"
                }
            ],
            "fields": [
                {
                    "value": "Gmail Credentials",
                    "label": "Select the proper keys to access an email address.",
                    "type": "header"
                },
                {
                    "value": "credentialId",
                    "label": "Credential",
                    "type": "credential"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Search Query",
                    "label": "Provide an optional query to filter results. By default, only unread messages are returned.",
                    "type": "header"
                },
                {
                    "value": "search",
                    "label": "Gmail Search Query"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Attachments",
                    "label": "Choose whether the job should also pull attachments from unread messages.",
                    "type": "header"
                },
                {
                    "value": "mode",
                    "label": "Download attachments?",
                    "options": [
                        {
                            "value": "withAttachments",
                            "label": "With attachments"
                        },
                        {
                            "value": "textOnly",
                            "label": "Get text only"
                        }
                    ]
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "action",
                    "label": "After getting results...",
                    "options": [
                        {
                            "value": "markAsRead",
                            "label": "Mark emails as read"
                        },
                        {
                            "value": "none",
                            "label": "Do nothing (results may repeat)"
                        }
                    ]
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Limit Results",
                    "label": "Choose the maximum number of results to return.",
                    "type": "header"
                },
                {
                    "value": "limit",
                    "label": "Limit",
                    "type": "number"
                }
            ]
        },
        {
            "name": "wordparrot-gmail.label",
            "title": "Gmail - Labels",
            "description": "Add label to specified messages.",
            "type": "pipelineNode",
            "initialValues": {
                "text": "",
                "limit": 10,
                "mode": "createIfNoneExisting",
                "color": "#ffffff",
                "background": "#cccccc"
            },
            "validationSchema": [
                {
                    "property": "text",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "mode",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "color",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "background",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "limit",
                    "type": "number",
                    "requirement": "required"
                }
            ],
            "fields": [
                {
                    "value": "Gmail Labels",
                    "label": "Add a label to messages.",
                    "type": "header"
                },
                {
                    "value": "credentialId",
                    "label": "Credential",
                    "type": "credential"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "text",
                    "label": "Label Text",
                    "type": "string"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "mode",
                    "label": "If we can't find a matching label...",
                    "options": [
                        {
                            "value": "createIfNoneExisting",
                            "label": "Create new label to use."
                        },
                        {
                            "value": "existingOnly",
                            "label": "Do nothing, use existing labels only."
                        }
                    ]
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Define colors",
                    "label": "Choose a text color and background color, if a new label needs to be created",
                    "type": "header",
                    "prerequisites": [
                        {
                            "property": "mode",
                            "value": "createIfNoneExisting",
                            "if": "equals"
                        }
                    ]
                },
                {
                    "value": "color",
                    "label": "Text Color",
                    "type": "colorPicker",
                    "prerequisites": [
                        {
                            "property": "mode",
                            "if": "equals",
                            "value": "createIfNoneExisting"
                        }
                    ]
                },
                {
                    "value": "background",
                    "label": "Background Color",
                    "type": "colorPicker",
                    "prerequisites": [
                        {
                            "property": "mode",
                            "if": "equals",
                            "value": "createIfNoneExisting"
                        }
                    ]
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space",
                    "prerequisites": [
                        {
                            "property": "mode",
                            "if": "equals",
                            "value": "createIfNoneExisting"
                        }
                    ]
                },
                {
                    "value": "Limit Results",
                    "label": "Choose the maximum number of messages to label.",
                    "type": "header"
                },
                {
                    "value": "limit",
                    "label": "Limit",
                    "type": "number"
                }
            ]
        }
    ],
    "listeners": [
        {
            "name": "wordparrot-gmail.inbox",
            "title": "Gmail - Inbox Listener",
            "description": "Listen for new emails to the provided address.",
            "type": "listener",
            "initialValues": {
                "credentialId": "",
                "values": {
                    "email": "",
                    "search": "is:unread",
                    "comparator": "moreThan",
                    "target": 0
                }
            },
            "validationSchema": [
                {
                    "property": "values.email",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "credentialId",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "values.search",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "values.comparator",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "values.target",
                    "type": "number",
                    "requirement": "required",
                    "min": 0
                }
            ],
            "fields": [
                {
                    "value": "Gmail Credentials",
                    "label": "Select the proper keys to access an email address.",
                    "type": "header"
                },
                {
                    "value": "credentialId",
                    "label": "Credential",
                    "type": "credential"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Email Address",
                    "label": "Enter relevant account to connect.",
                    "type": "header"
                },
                {
                    "value": "values.email",
                    "label": "Email address"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Search Query",
                    "label": "Enter a Gmail-compatible query string. By default, it will search for unread emails.",
                    "type": "header"
                },
                {
                    "value": "values.search",
                    "label": "Enter search query"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Add condition",
                    "label": "When should this listener trigger downstream pipelines?",
                    "type": "header"
                },
                {
                    "value": "values.comparator",
                    "label": "If we have...",
                    "type": "select",
                    "options": [
                        {
                            "value": "moreThan",
                            "label": "More Than"
                        },
                        {
                            "value": "lessThan",
                            "label": "Less Than"
                        },
                        {
                            "value": "exactly",
                            "label": "Exactly"
                        }
                    ]
                },
                {
                    "value": "values.target",
                    "label": "# of email results",
                    "type": "number"
                }
            ]
        }
    ],
    "credentials": [
        {
            "name": "wordparrot-gmail.read",
            "title": "Gmail Credentials",
            "description": "Add Gmail authorization credentials",
            "fields": [
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Email Account",
                    "label": "Enter relevant account to connect.",
                    "type": "header"
                },
                {
                    "value": "username",
                    "label": "Email address"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Google API keys",
                    "label": "Create keys using Google's console.",
                    "type": "header",
                    "link": {
                        "text": "See how to create keys here.",
                        "href": ""
                    }
                },
                {
                    "value": "clientId",
                    "label": "Client ID",
                    "type": "text"
                },
                {    
                    "value": "clientSecret",
                    "label": "Client Secret",
                    "type": "text"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "oAuth Redirect URI",
                    "label": "This should be the same value as the one you provide to the Google Console.",
                    "type": "header"
                },
                {
                    "value": "",
                    "label": "If you're unsure, you can use the default value {origin}/redirect/print.",
                    "type": "subheader"
                },
                {    
                    "value": "redirectURI",
                    "label": "Redirect URI",
                    "type": "text"
                },
                {
                    "value": "30px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "Obtaining an authorization code",
                    "label": "Retrieve an authorization code by logging into Gmail. Find the code after you login and are redirected.",
                    "type": "header",
                    "link": {
                        "text": "Authenticate to Gmail here.",
                        "href": "https://accounts.google.com/o/oauth2/v2/auth?client_id={clientId}&response_type=code&scope=https://www.googleapis.com/auth/gmail.send%20https://www.googleapis.com/auth/gmail.labels%20https://www.googleapis.com/auth/gmail.readonly%20https://www.googleapis.com/auth/gmail.compose%20https://www.googleapis.com/auth/gmail.modify&redirect_uri={redirectURI}&access_type=offline"
                    }
                },
                {
                    "value": "10px",
                    "label": "",
                    "type": "space"
                },
                {
                    "value": "",
                    "label": "Once you\"ve succeeded, copy the code from the webpage to your clipboard and then paste here.",
                    "type": "subheader"
                },
                {
                    "value": "authResponse",
                    "label": "Code"
                }
            ],
            "initialValues": {
                "title": "",
                "content": "",
                "provider": "wordparrot-gmail.read",
                "clientId": "",
                "clientSecret": "",
                "authResponse": "",
                "hasAuthCallback": true,
                "hasAuthTest": true,
                "username": ""
            },
            "validationSchema": [
                {
                    "property": "title",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "content",
                    "type": "string",
                    "requirement": "optional"
                },
                {
                    "property": "clientId",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "clientSecret",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "redirectURI",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "authResponse",
                    "type": "string",
                    "requirement": "required"
                },
                {
                    "property": "username",
                    "type": "email",
                    "requirement": "required"
                }
            ],
            "actions": [
                "gmail.read"
            ]
        }
    ]
}